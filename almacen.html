<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almac√©n - Academia Moncayo</title>
    <link rel="stylesheet" href="src/css/variables.css">
    <link rel="stylesheet" href="src/css/dashboard.css">
    <link rel="stylesheet" href="src/css/storage.css">
</head>
<body>

<div id="app-header"></div>

    <main class="main-content">
        <div class="page-header">
            <h1>Inventario y Almac√©n</h1>
            <div style="display:flex; gap:10px;">
                <button id="btnOpenHistory" class="btn-primary" style="background:#607d8b; font-size:13px;">üìú Historial</button>
                <button id="btnOpenSalida" class="btn-primary" style="background-color: #d32f2f;">üì§ Registrar Salida</button>
                <button id="btnOpenModal" class="btn-primary">üì¶ Nuevo Producto</button>
            </div>
        </div>

        <div class="content-card">
            
            <div class="toolbar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Buscar producto...">
                </div>
                <div class="filter-box">
                    <label>Stock:</label>
                    <select id="filterStock">
                        <option value="todos">Todos</option>
                        <option value="bajo">‚ö†Ô∏è Bajo Stock</option>
                        <option value="agotado">‚ùå Agotado</option>
                    </select>
                </div>
                <div class="filter-box">
                    <label>Categor√≠a:</label>
                    <select id="filterCategory">
                        <option value="todos">Todas</option>
                        <option value="Instrumentos">Instrumentos</option>
                        <option value="Accesorios">Accesorios</option>
                        <option value="Libros">Libros</option>
                        <option value="Papeleria">Papeler√≠a</option>
                        <option value="Limpieza">Limpieza</option>
                    </select>
                </div>
            </div>

            <div style="background:#e3f2fd; padding:10px; border-radius:6px; margin-bottom:15px; text-align:right; font-size:14px; color:#0d47a1;">
                Valor Total Inventario: <strong id="totalInventoryValue">$0.00</strong>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Categor√≠a</th>
                            <th style="text-align: center;">Stock Actual</th>
                            <th>Precio Unit.</th>
                            <th>Valor Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
                <p id="noResults" class="hidden" style="text-align:center; padding: 20px; color:#666;">No se encontraron productos.</p>
            </div>

            <div class="pagination-controls">
                <button id="btnPrevPage" disabled>‚ùÆ Anterior</button>
                <span id="pageIndicator">P√°gina 1</span>
                <button id="btnNextPage">Siguiente ‚ùØ</button>
            </div>
        </div>
    </main>

    <div id="modalContainer" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nuevo Producto</h3>
                <span id="btnCloseModal" class="close-btn">&times;</span>
            </div>
            <form id="formProduct">
                <input type="hidden" id="editId">
                
                <label>Nombre del Producto:</label>
                <input type="text" id="prodNombre" required>

                <div class="form-row">
                    <div style="flex:1">
                        <label>Categor√≠a:</label>
                        <select id="prodCategoria">
                            <option value="Instrumentos">Instrumentos</option>
                            <option value="Accesorios">Accesorios</option>
                            <option value="Libros">Libros</option>
                            <option value="Papeleria">Papeler√≠a</option>
                            <option value="Limpieza">Limpieza</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                    <div style="flex:1">
                        <label>Cantidad Inicial:</label>
                        <input type="number" id="prodCantidad" required min="0">
                    </div>
                </div>

                <div class="form-row">
                    <div style="flex:1">
                        <label>Precio Unitario ($):</label>
                        <input type="number" id="prodPrecio" required min="0" step="0.50">
                    </div>
                    <div style="flex:1; display:flex; align-items:center; justify-content:center; background:#f9f9f9; border-radius:5px; margin-bottom:15px;">
                        <span id="calcTotal" style="font-weight:bold; color:#2e7d32;">$0.00</span>
                    </div>
                </div>

                <label>Descripci√≥n / Notas:</label>
                <input type="text" id="prodDesc">

                <button type="submit" class="btn-save">Guardar Producto</button>
            </form>
        </div>
    </div>

    <div id="modalRestock" class="modal-overlay hidden">
        <div class="modal-content" style="width: 400px;">
            <div class="modal-header">
                <h3>üì• Entrada de Stock</h3>
                <span id="btnCloseRestock" class="close-btn">&times;</span>
            </div>
            <form id="formRestock">
                <input type="hidden" id="restockId">
                <p id="restockName" style="font-weight:bold; color:#2c3e50; margin-bottom:15px;">Producto...</p>
                
                <label>Cantidad a Agregar (+):</label>
                <input type="number" id="restockQty" required min="1" style="font-size:18px; text-align:center;">
                
                <button type="submit" class="btn-save" style="background-color:#4caf50;">Confirmar Entrada</button>
            </form>
        </div>
    </div>

    <div id="modalSalida" class="modal-overlay hidden">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <h3>üì§ Registrar Salida de Material</h3>
                <span id="btnCloseSalida" class="close-btn">&times;</span>
            </div>
            
            <div class="add-to-cart-box">
                <div style="flex:3">
                    <input list="listProductsOut" id="inputProdOut" placeholder="Escribe para buscar producto...">
                    <datalist id="listProductsOut"></datalist>
                    <input type="hidden" id="idProdOut">
                </div>
                <div style="flex:1">
                    <input type="number" id="qtyProdOut" value="1" min="1" placeholder="Cant.">
                </div>
                <button id="btnAddToCart" class="btn-save" style="width:auto; margin:0;">Agregar</button>
            </div>

            <div class="table-container" style="max-height: 200px; overflow-y:auto; border:1px solid #eee; margin-bottom:15px;">
                <table style="font-size:13px;">
                    <thead style="background:#eee; position:sticky; top:0;">
                        <tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Subtotal</th><th></th></tr>
                    </thead>
                    <tbody id="cartBody"></tbody>
                </table>
                <div id="emptyCartMsg" style="text-align:center; padding:20px; color:#999;">Carrito vac√≠o</div>
            </div>

            <div class="cart-summary">
                <span>Total Piezas: <span id="sumQty">0</span></span>
                <span style="font-size:16px;">Total Valor: <span id="sumTotal">$0.00</span></span>
            </div>

            <div class="form-row" style="margin-top:15px;">
                <div style="flex:2">
                    <label>Motivo de Salida:</label>
                    <select id="salidaMotivo">
                        <option value="Venta">Venta</option>
                        <option value="Consumo Interno">Consumo Interno</option>
                        <option value="Merma/Da√±o">Merma / Da√±o</option>
                        <option value="Regalo">Regalo / Promoci√≥n</option>
                    </select>
                </div>
                <div style="flex:1">
                    <label>Referencia (Opcional):</label>
                    <input type="text" id="salidaRef" placeholder="Ej. Alumno X">
                </div>
            </div>

            <button id="btnConfirmOutput" class="btn-save" style="background-color:#d32f2f;">Confirmar Salida</button>
        </div>
    </div>

    <div id="modalHistory" class="modal-overlay hidden">
        <div class="modal-content" style="width: 800px;">
            <div class="modal-header">
                <h3>üìú Historial de Movimientos</h3>
                <span id="btnCloseHistory" class="close-btn">&times;</span>
            </div>
            
            <div class="toolbar" style="border:none; padding-bottom:10px; margin-bottom:10px;">
                <input type="date" id="histStart">
                <input type="date" id="histEnd">
                <select id="histType">
                    <option value="todos">Todos</option>
                    <option value="entrada">Entradas</option>
                    <option value="salida">Salidas</option>
                </select>
                <button id="btnFilterHistory" class="btn-primary" style="padding:5px 10px; font-size:12px;">Filtrar</button>
            </div>

            <div class="table-container" style="max-height: 400px; overflow-y:auto;">
                <table style="font-size:12px;">
                    <thead style="position:sticky; top:0; background:#eee;">
                        <tr><th>Fecha</th><th>Tipo</th><th>Producto</th><th>Cant.</th><th>Detalle</th><th>Valor</th></tr>
                    </thead>
                    <tbody id="historyBody"></tbody>
                </table>
            </div>
            
            <div style="background:#f9f9f9; padding:10px; font-size:12px; display:flex; justify-content:space-around; font-weight:bold; color:#555;">
                <span>Movimientos: <span id="histCount">0</span></span>
                <span>Piezas Totales: <span id="histPiezas">0</span></span>
                <span>Valor Total: <span id="histValor">$0.00</span></span>
            </div>
        <div style="text-align: right; margin-top: 15px; display:flex; justify-content:flex-end; gap:10px;">
                 <button class="btn-save" onclick="document.getElementById('modalHistory').classList.add('hidden')" style="background:#6c757d; width:auto;">Cerrar</button>
                 
                 <button id="btnPrintReport" class="btn-primary" style="width:auto;">üñ®Ô∏è Generar PDF / Imprimir</button>
            </div>
        </div>
    </div>

    <div id="modalConfirm" class="modal-overlay hidden">
        <div class="modal-content" style="width: 400px; text-align: center;">
            <div style="font-size: 50px; margin-bottom: 15px; animation: bounce 1s infinite;">‚ö†Ô∏è</div>
            <h3 id="confirmTitle" style="margin: 0; color: #333;">¬øEst√°s seguro?</h3>
            <p id="confirmMessage" style="color: #666; margin: 10px 0 25px;">Esta acci√≥n es irreversible.</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="btnCancelConfirm" style="background:#e0e0e0; color:#333; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">Cancelar</button>
                <button id="btnOkConfirm" style="background:#c62828; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:bold;">S√≠, Continuar</button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script type="module" src="src/js/storage.js"></script>
    <script src="common.js"></script>
</body>
</html>